---
- name: "prerequisites | Update opkg cache"
  community.general.opkg:
    name: ~  # noqa args[module]
    update_cache: true
  changed_when: false
  check_mode: false
  when: true
  register: prerequisites_opkg_cache_update
  failed_when:
    - '"False: Unknown package" not in prerequisites_opkg_cache_update.msg'

- name: "prerequisites | Fail when no facts available"
  ansible.builtin.fail:
    msg: "Ensure you run this role in a playbook with 'gather_facts: true'"
  when: ansible_facts.keys() | length == 0

- name: "prerequisites | Install role gekmihesg.openwrt"
  community.general.ansible_galaxy_install:
    type: "role"
    name: "gekmihesg.openwrt"
  delegate_to: localhost

- name: "prerequisites | Apply gekmihesg.openwrt role"
  ansible.builtin.import_role:
    name: "gekmihesg.openwrt"
